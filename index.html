<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pak Model Institute</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #121212;
            --bg-secondary: #1E1E1E;
            --accent: #00BFFF;
            --accent-green: #00D26A;
            --accent-gold: #FFD700;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --border-radius: 12px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        /* Header Styles - Improved */
        header {
            background: linear-gradient(135deg, var(--bg-secondary), #2a2a2a);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--accent);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1.2rem;
        }

        .logo {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent), #0066CC);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 191, 255, 0.4);
            border: 2px solid white;
            transition: var(--transition);
        }

        .logo:hover {
            transform: rotate(10deg) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 191, 255, 0.6);
        }

        .header-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--accent), var(--accent-green), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 191, 255, 0.3);
        }

        .header-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: -5px;
            font-weight: 400;
        }

        .datetime-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }

        .date-display {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent);
        }

        .time-display {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-green);
            text-shadow: 0 2px 8px rgba(0, 210, 106, 0.3);
        }

        .master-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent), #0066CC);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.7rem;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(0, 191, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 191, 255, 0.5);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-green), #00AA55);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--accent-gold), #FFAA00);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .btn-outline:hover {
            background: rgba(0, 191, 255, 0.1);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Side Menu Styles */
        .side-menu {
            position: fixed;
            top: 90px;
            left: 0;
            width: 260px;
            height: calc(100vh - 90px);
            background: linear-gradient(180deg, var(--bg-secondary), #2a2a2a);
            padding: 1.5rem 0;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 900;
            border-right: 1px solid #333;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2);
        }

        .menu-item {
            padding: 1.1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            margin: 0.5rem 1rem;
            border-radius: 8px;
            position: relative;
        }

        .menu-item:hover {
            background: rgba(0, 191, 255, 0.15);
            transform: translateX(8px);
            border-left-color: var(--accent);
        }

        .menu-item.active {
            background: rgba(0, 191, 255, 0.2);
            border-left-color: var(--accent);
            color: var(--accent);
            box-shadow: 0 4px 12px rgba(0, 191, 255, 0.2);
        }

        .menu-item i {
            width: 22px;
            text-align: center;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .menu-item.active i {
            transform: scale(1.1);
            color: var(--accent);
        }

        .menu-badge {
            position: absolute;
            right: 1.5rem;
            background: var(--accent-green);
            color: white;
            border-radius: 12px;
            padding: 0.2rem 0.6rem;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--accent);
            background: rgba(0, 191, 255, 0.1);
            padding: 0.5rem;
            border-radius: 8px;
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background: rgba(0, 191, 255, 0.2);
        }

        /* Main Content Styles */
        .main-content {
            margin-left: 260px;
            margin-top: 90px;
            padding: 2rem;
            max-width: 1200px;
            transition: var(--transition);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card Styles */
        .card {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1.8rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent), var(--accent-green));
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
            border-color: var(--accent);
        }

        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.8rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, var(--bg-secondary), #2a2a2a);
            position: relative;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent-green));
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 700;
            margin: 0.5rem 0;
            color: var(--accent);
            text-shadow: 0 2px 12px rgba(0, 191, 255, 0.4);
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .currency {
            font-size: 1.5rem;
            color: var(--accent-gold);
            font-weight: 700;
        }

        /* Tiles Styles */
        .tiles-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
            gap: 1.8rem;
            margin-bottom: 2.5rem;
        }

        .tile {
            height: 130px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            cursor: pointer;
            background: linear-gradient(135deg, var(--bg-secondary), #2a2a2a);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .tile::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 191, 255, 0.1), transparent);
            transition: var(--transition);
        }

        .tile:hover::before {
            left: 100%;
        }

        .tile:hover {
            background: linear-gradient(135deg, rgba(0, 191, 255, 0.15), var(--bg-secondary));
            transform: translateY(-5px) scale(1.03);
        }

        .tile i {
            font-size: 2.8rem;
            margin-bottom: 0.8rem;
            color: var(--accent);
            text-shadow: 0 2px 12px rgba(0, 191, 255, 0.4);
            transition: var(--transition);
        }

        .tile:hover i {
            transform: scale(1.1);
            color: var(--accent-green);
        }

        /* Form Styles */
        .form-container {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 2.2rem;
            margin-bottom: 2.5rem;
            border: 1px solid #333;
            position: relative;
        }

        .form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent-green));
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.8rem;
        }

        .form-group {
            margin-bottom: 1.8rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 1.1rem;
            border-radius: var(--border-radius);
            border: 1px solid #333;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            transition: var(--transition);
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 191, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Table Styles */
        .table-container {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1.8rem;
            overflow-x: auto;
            border: 1px solid #333;
            position: relative;
        }

        .table-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent-green));
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
        }

        th, td {
            padding: 1.2rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid #333;
        }

        th {
            background: rgba(0, 0, 0, 0.3);
            font-weight: 600;
            color: var(--accent);
            font-size: 0.95rem;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 0.6rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* Attendance Toggles */
        .attendance-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .toggle-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid #333;
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
        }

        .toggle-btn.active {
            background: var(--accent-green);
            color: white;
            border-color: var(--accent-green);
        }

        .toggle-btn.absent {
            background: #FF4757;
            color: white;
            border-color: #FF4757;
        }

        /* Chart Container */
        .chart-container {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            height: 300px;
            border: 1px solid #333;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }

            .side-menu {
                transform: translateX(-100%);
                width: 280px;
            }

            .side-menu.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1.2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stat-cards, .tiles-container {
                grid-template-columns: 1fr;
            }

            header {
                padding: 1rem 1.2rem;
            }

            .header-title {
                font-size: 1.4rem;
            }

            .header-subtitle {
                font-size: 0.8rem;
            }

            .datetime-container {
                gap: 0.2rem;
            }

            .date-display {
                font-size: 0.9rem;
            }

            .time-display {
                font-size: 1rem;
            }

            .master-controls {
                gap: 0.6rem;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }

            .logo {
                width: 45px;
                height: 45px;
                font-size: 1.5rem;
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mb-1 {
            margin-bottom: 1rem;
        }

        .mb-2 {
            margin-bottom: 2rem;
        }

        .mt-1 {
            margin-top: 1rem;
        }

        .mt-2 {
            margin-top: 2rem;
        }

        .hidden {
            display: none;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.2rem;
            border-bottom: 2px solid #333;
        }

        .section-title {
            font-size: 2rem;
            background: linear-gradient(45deg, var(--accent), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 191, 255, 0.3);
        }

        /* PKR Currency Styling */
        .pkr-amount {
            color: var(--accent-gold);
            font-weight: 700;
            font-size: 1.1em;
        }

        .pkr-symbol {
            color: var(--accent-gold);
            font-weight: 700;
            margin-right: 0.2rem;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: translateY(-20px);
            transition: var(--transition);
            border: 1px solid #333;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #333;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--accent);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #333;
        }

        /* Status Badges */
        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-present {
            background: rgba(0, 210, 106, 0.2);
            color: var(--accent-green);
        }

        .status-absent {
            background: rgba(255, 71, 87, 0.2);
            color: #FF4757;
        }

        .status-paid {
            background: rgba(255, 215, 0, 0.2);
            color: var(--accent-gold);
        }

        .status-pending {
            background: rgba(255, 165, 0, 0.2);
            color: orange;
        }
    </style>
</head>
<body>
    <!-- Header - Improved Design -->
    <header>
        <div class="logo-container">
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div>
                <h1 class="header-title">Pak Model Institute</h1>
                <div class="header-subtitle">Science, Commerce & Economics</div>
            </div>
        </div>
        
        <div class="datetime-container">
            <div class="date-display" id="current-date">Loading...</div>
            <div class="time-display" id="current-time">Loading...</div>
        </div>
        
        <div class="master-controls">
            <button class="btn btn-primary" id="notification-btn">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">3</span>
            </button>
            <button class="btn btn-gold">
                <i class="fas fa-coins"></i> PKR
            </button>
            <button class="btn" id="settings-btn">
                <i class="fas fa-cog"></i> Master
            </button>
            <button class="btn btn-outline">
                <i class="fas fa-user-shield"></i> Admin
            </button>
        </div>
    </header>

    <!-- Side Menu -->
    <nav class="side-menu">
        <div class="menu-item active" data-section="dashboard">
            <i class="fas fa-chart-bar"></i> Dashboard
            <span class="menu-badge">New</span>
        </div>
        <div class="menu-item" data-section="admissions">
            <i class="fas fa-user-graduate"></i> Admissions
            <span class="menu-badge">5</span>
        </div>
        <div class="menu-item" data-section="teachers">
            <i class="fas fa-chalkboard-teacher"></i> Teachers
        </div>
        <div class="menu-item" data-section="attendance">
            <i class="fas fa-calendar-check"></i> Attendance
        </div>
        <div class="menu-item" data-section="fees">
            <i class="fas fa-money-bill-wave"></i> Fees
            <span class="menu-badge">12</span>
        </div>
        <div class="menu-item" data-section="reports">
            <i class="fas fa-chart-line"></i> Reports
        </div>
        <div class="menu-item" data-section="classes">
            <i class="fas fa-school"></i> Manage Classes
        </div>
        <div class="menu-item" data-section="settings">
            <i class="fas fa-cogs"></i> Settings
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="section-header">
                <h2 class="section-title">Dashboard Overview</h2>
                <div class="datetime-container">
                    <div class="date-display" id="dashboard-date">Loading...</div>
                </div>
            </div>
            
            <!-- Stat Cards -->
            <div class="stat-cards">
                <div class="card stat-card">
                    <div class="stat-value" id="total-students">0</div>
                    <div class="stat-label">Total Students</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="total-teachers">0</div>
                    <div class="stat-label">Total Teachers</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value">
                        <span class="pkr-symbol">₨</span>
                        <span id="pending-fees">0</span>
                    </div>
                    <div class="stat-label">Pending Fees</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="total-classes">0</div>
                    <div class="stat-label">Active Classes</div>
                </div>
            </div>
            
            <!-- Quick Actions Tiles -->
            <h3 class="mb-1">Quick Actions</h3>
            <div class="tiles-container">
                <div class="card tile" data-section="attendance">
                    <i class="fas fa-calendar-check"></i>
                    <div>Mark Attendance</div>
                </div>
                <div class="card tile" data-section="admissions">
                    <i class="fas fa-user-graduate"></i>
                    <div>New Admission</div>
                </div>
                <div class="card tile" data-section="fees">
                    <i class="fas fa-money-bill-wave"></i>
                    <div>Collect Fees</div>
                </div>
                <div class="card tile" data-section="teachers">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <div>Add Teacher</div>
                </div>
                <div class="card tile" data-section="reports">
                    <i class="fas fa-chart-line"></i>
                    <div>View Reports</div>
                </div>
                <div class="card tile" data-section="classes">
                    <i class="fas fa-school"></i>
                    <div>Manage Classes</div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card mt-2">
                <h3 class="mb-1">Recent Activity</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Activity</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recent-activity">
                            <!-- Recent activities will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Admissions Section -->
        <section id="admissions" class="section">
            <div class="section-header">
                <h2 class="section-title">Student Admissions</h2>
                <button class="btn btn-primary" id="new-admission-btn">
                    <i class="fas fa-plus"></i> New Admission
                </button>
            </div>
            
            <div class="form-container">
                <h3 class="mb-1">Add New Student</h3>
                <form id="admission-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="student-name">Student Name</label>
                            <input type="text" id="student-name" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="father-name">Father Name</label>
                            <input type="text" id="father-name" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="dob">Date of Birth</label>
                            <input type="date" id="dob" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="student-class">Class</label>
                            <select id="student-class" class="form-input" required>
                                <option value="">Select Class</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="contact">Contact Number</label>
                            <input type="tel" id="contact" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="emergency-contact">Emergency Contact</label>
                            <input type="tel" id="emergency-contact" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="address">Address</label>
                        <textarea id="address" class="form-input" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Student</button>
                </form>
            </div>
            
            <div class="table-container">
                <h3 class="mb-1">Students List</h3>
                <table id="students-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Father Name</th>
                            <th>Class</th>
                            <th>Contact</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Students will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Teachers Section -->
        <section id="teachers" class="section">
            <div class="section-header">
                <h2 class="section-title">Teachers Management</h2>
                <button class="btn btn-primary" id="new-teacher-btn">
                    <i class="fas fa-plus"></i> Add Teacher
                </button>
            </div>
            
            <div class="form-container">
                <h3 class="mb-1">Add New Teacher</h3>
                <form id="teacher-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="teacher-name">Teacher Name</label>
                            <input type="text" id="teacher-name" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="subject">Subject</label>
                            <input type="text" id="subject" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="teacher-contact">Contact Number</label>
                            <input type="tel" id="teacher-contact" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="assigned-class">Assigned Class</label>
                            <select id="assigned-class" class="form-input" required>
                                <option value="">Select Class</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Teacher</button>
                </form>
            </div>
            
            <div class="table-container">
                <h3 class="mb-1">Teachers List</h3>
                <table id="teachers-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Subject</th>
                            <th>Contact</th>
                            <th>Assigned Class</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Teachers will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Attendance Section -->
        <section id="attendance" class="section">
            <div class="section-header">
                <h2 class="section-title">Attendance Management</h2>
                <div class="datetime-container">
                    <div class="date-display" id="attendance-date-display">Loading...</div>
                </div>
            </div>
            
            <div class="form-container">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="attendance-class">Select Class</label>
                        <select id="attendance-class" class="form-input" required>
                            <option value="">Select Class</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="attendance-date">Date</label>
                        <input type="date" id="attendance-date" class="form-input" required>
                    </div>
                </div>
            </div>
            
            <div class="table-container" id="attendance-table-container">
                <h3 class="mb-1">Mark Attendance</h3>
                <table id="attendance-table">
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Student Name</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Attendance records will be populated here -->
                    </tbody>
                </table>
                <button class="btn btn-primary mt-2" id="save-attendance">Save Attendance</button>
            </div>
        </section>

        <!-- Fees Section -->
        <section id="fees" class="section">
            <div class="section-header">
                <h2 class="section-title">Fees Management</h2>
                <button class="btn btn-primary" id="collect-fee-btn">
                    <i class="fas fa-money-bill-wave"></i> Collect Fee
                </button>
            </div>
            
            <div class="form-container">
                <h3 class="mb-1">Collect Fee</h3>
                <form id="fee-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="fee-student">Select Student</label>
                            <select id="fee-student" class="form-input" required>
                                <option value="">Select Student</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="fee-month">Month</label>
                            <input type="month" id="fee-month" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="fee-amount">Amount (PKR)</label>
                            <input type="number" id="fee-amount" class="form-input" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Collect Fee</button>
                </form>
            </div>
            
            <div class="table-container">
                <h3 class="mb-1">Fees Records</h3>
                <div class="form-grid mb-1">
                    <div class="form-group">
                        <label class="form-label" for="filter-class">Filter by Class</label>
                        <select id="filter-class" class="form-input">
                            <option value="">All Classes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="filter-month">Filter by Month</label>
                        <input type="month" id="filter-month" class="form-input">
                    </div>
                </div>
                <table id="fees-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Student Name</th>
                            <th>Class</th>
                            <th>Month</th>
                            <th>Amount</th>
                            <th>Date Paid</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Fees records will be populated here -->
                    </tbody>
                </table>
                <div class="mt-2">
                    <button class="btn btn-gold" id="generate-receipt">Generate Receipt</button>
                    <button class="btn btn-outline" id="export-fees">Export to CSV</button>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="section">
            <div class="section-header">
                <h2 class="section-title">Reports & Analytics</h2>
                <button class="btn btn-primary" id="refresh-reports">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <div class="chart-container">
                <canvas id="attendance-chart"></canvas>
            </div>
            
            <div class="chart-container">
                <canvas id="fees-chart"></canvas>
            </div>
            
            <div class="card mt-2">
                <h3 class="mb-1">Export Data</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="export-type">Export Type</label>
                        <select id="export-type" class="form-input">
                            <option value="students">Students</option>
                            <option value="teachers">Teachers</option>
                            <option value="attendance">Attendance</option>
                            <option value="fees">Fees</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="export-format">Format</label>
                        <select id="export-format" class="form-input">
                            <option value="csv">CSV</option>
                            <option value="json">JSON</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary mt-1" id="export-data">Export Data</button>
            </div>
        </section>

        <!-- Classes Section -->
        <section id="classes" class="section">
            <div class="section-header">
                <h2 class="section-title">Manage Classes</h2>
                <button class="btn btn-primary" id="new-class-btn">
                    <i class="fas fa-plus"></i> New Class
                </button>
            </div>
            
            <div class="form-container">
                <h3 class="mb-1">Add New Class</h3>
                <form id="class-form">
                    <div class="form-group">
                        <label class="form-label" for="class-name">Class Name</label>
                        <input type="text" id="class-name" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Class</button>
                </form>
            </div>
            
            <div class="table-container">
                <h3 class="mb-1">Classes List</h3>
                <table id="classes-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Class Name</th>
                            <th>Students Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Classes will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section">
            <div class="section-header">
                <h2 class="section-title">Settings & Utilities</h2>
                <button class="btn btn-primary" id="save-settings">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
            
            <div class="card mb-2">
                <h3 class="mb-1">Theme Settings</h3>
                <div class="form-group">
                    <label class="form-label">Theme</label>
                    <div>
                        <button class="btn btn-primary" id="dark-theme">Dark Theme</button>
                        <button class="btn btn-outline" id="light-theme">Light Theme</button>
                    </div>
                </div>
            </div>
            
            <div class="card mb-2">
                <h3 class="mb-1">Data Management</h3>
                <div class="form-group">
                    <label class="form-label">Backup & Restore</label>
                    <div>
                        <button class="btn btn-outline" id="backup-data">Backup Data</button>
                        <button class="btn btn-outline" id="restore-data">Restore Data</button>
                    </div>
                </div>
                <div class="form-group mt-1">
                    <label class="form-label">Danger Zone</label>
                    <div>
                        <button class="btn" id="clear-data" style="background-color: #ff4757;">Clear All Data</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div class="modal" id="confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmation-message">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-action">Cancel</button>
                <button class="btn" id="confirm-action">Confirm</button>
            </div>
        </div>
    </div>

    <div class="modal" id="data-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="data-modal-title">Data</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="data-content" class="form-input" rows="10" style="width: 100%;"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="copy-data">Copy</button>
                <button class="btn btn-outline" id="close-data">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Data Models
        const dataModels = {
            classes: [],
            students: [],
            teachers: [],
            attendance: [],
            fees: []
        };

        // Chart instances
        let attendanceChart, feesChart;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Load data from localStorage
            loadData();
            
            // Update date and time
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Update dashboard stats
            updateDashboardStats();
            
            // Populate class dropdowns
            populateClassDropdowns();
            
            // Populate student dropdowns
            populateStudentDropdowns();
            
            // Render initial tables
            renderClassesTable();
            renderStudentsTable();
            renderTeachersTable();
            renderFeesTable();
            
            // Initialize charts
            initializeCharts();
        }

        function loadData() {
            for (const key in dataModels) {
                const storedData = localStorage.getItem(`pmi_${key}`);
                if (storedData) {
                    dataModels[key] = JSON.parse(storedData);
                }
            }
            
            // If no data exists, create sample data
            if (dataModels.classes.length === 0) {
                createSampleData();
            }
        }

        function createSampleData() {
            // Create sample classes
            dataModels.classes = [
                { id: '1', className: 'Class 9' },
                { id: '2', className: 'Class 10' },
                { id: '3', className: 'Class 11 Science' },
                { id: '4', className: 'Class 11 Commerce' },
                { id: '5', className: 'Class 12 Science' },
                { id: '6', className: 'Class 12 Commerce' }
            ];
            
            // Create sample students
            dataModels.students = [
                { 
                    id: '1', 
                    name: 'Ali Ahmed', 
                    fatherName: 'Ahmed Khan', 
                    dob: '2005-03-15', 
                    class: '1', 
                    contact: '0300-1234567', 
                    address: 'House 123, Street 45, Karachi',
                    emergencyContact: '0300-7654321'
                },
                { 
                    id: '2', 
                    name: 'Sara Khan', 
                    fatherName: 'Khalid Khan', 
                    dob: '2006-07-22', 
                    class: '2', 
                    contact: '0312-3456789', 
                    address: 'Apartment 5-B, Block 7, Lahore',
                    emergencyContact: '0312-9876543'
                }
            ];
            
            // Create sample teachers
            dataModels.teachers = [
                { 
                    id: '1', 
                    name: 'Dr. Muhammad Ali', 
                    subject: 'Mathematics', 
                    contact: '0333-1234567', 
                    classAssigned: '1'
                },
                { 
                    id: '2', 
                    name: 'Ms. Fatima Javed', 
                    subject: 'Physics', 
                    contact: '0333-7654321', 
                    classAssigned: '3'
                }
            ];
            
            // Create sample fees
            dataModels.fees = [
                { 
                    id: '1', 
                    studentId: '1', 
                    month: '2023-11', 
                    amount: '5000', 
                    date: '2023-11-15',
                    status: 'paid'
                }
            ];
            
            // Save all data
            for (const key in dataModels) {
                saveData(key);
            }
        }

        function saveData(key) {
            localStorage.setItem(`pmi_${key}`, JSON.stringify(dataModels[key]));
        }

        function updateDateTime() {
            const now = new Date();
            
            // Date formatting
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-PK', dateOptions);
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-PK', timeOptions);
            document.getElementById('dashboard-date').textContent = now.toLocaleDateString('en-PK', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric'
            });
            
            // Set default attendance date to today
            const today = now.toISOString().split('T')[0];
            document.getElementById('attendance-date').value = today;
            document.getElementById('attendance-date-display').textContent = now.toLocaleDateString('en-PK', dateOptions);
        }

        function initializeEventListeners() {
            // Menu navigation
            document.querySelectorAll('.menu-item, .tile').forEach(item => {
                item.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    if (sectionId) {
                        showSection(sectionId);
                        
                        // Update active menu item
                        document.querySelectorAll('.menu-item').forEach(menuItem => {
                            menuItem.classList.remove('active');
                        });
                        
                        if (this.classList.contains('menu-item')) {
                            this.classList.add('active');
                        } else {
                            // If it's a tile, find the corresponding menu item
                            const menuItem = document.querySelector(`.menu-item[data-section="${sectionId}"]`);
                            if (menuItem) {
                                menuItem.classList.add('active');
                            }
                        }
                        
                        // Close mobile menu if open
                        document.querySelector('.side-menu').classList.remove('active');
                    }
                });
            });
            
            // Mobile menu toggle
            document.querySelector('.menu-toggle').addEventListener('click', function() {
                document.querySelector('.side-menu').classList.toggle('active');
            });
            
            // Form submissions
            document.getElementById('class-form').addEventListener('submit', handleClassFormSubmit);
            document.getElementById('admission-form').addEventListener('submit', handleAdmissionFormSubmit);
            document.getElementById('teacher-form').addEventListener('submit', handleTeacherFormSubmit);
            document.getElementById('fee-form').addEventListener('submit', handleFeeFormSubmit);
            
            // Attendance
            document.getElementById('attendance-class').addEventListener('change', loadAttendanceStudents);
            document.getElementById('attendance-date').addEventListener('change', function() {
                const date = new Date(this.value);
                document.getElementById('attendance-date-display').textContent = date.toLocaleDateString('en-PK', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric'
                });
                loadAttendanceStudents();
            });
            document.getElementById('save-attendance').addEventListener('click', saveAttendance);
            
            // Fees filters
            document.getElementById('filter-class').addEventListener('change', renderFeesTable);
            document.getElementById('filter-month').addEventListener('change', renderFeesTable);
            
            // Export buttons
            document.getElementById('export-data').addEventListener('click', exportData);
            document.getElementById('export-fees').addEventListener('click', exportFeesToCSV);
            document.getElementById('generate-receipt').addEventListener('click', generateReceipt);
            
            // Settings
            document.getElementById('dark-theme').addEventListener('click', () => setTheme('dark'));
            document.getElementById('light-theme').addEventListener('click', () => setTheme('light'));
            document.getElementById('backup-data').addEventListener('click', backupData);
            document.getElementById('restore-data').addEventListener('click', restoreData);
            document.getElementById('clear-data').addEventListener('click', confirmClearData);
            
            // Modal controls
            document.querySelectorAll('.modal-close, #cancel-action, #close-data').forEach(btn => {
                btn.addEventListener('click', closeModals);
            });
            
            document.getElementById('confirm-action').addEventListener('click', executeConfirmedAction);
            document.getElementById('copy-data').addEventListener('click', copyDataToClipboard);
            
            // Master settings button
            document.getElementById('settings-btn').addEventListener('click', () => showSection('settings'));
            
            // Refresh reports button
            document.getElementById('refresh-reports').addEventListener('click', updateCharts);
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show the selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Special handling for certain sections
            if (sectionId === 'attendance') {
                loadAttendanceStudents();
            } else if (sectionId === 'reports') {
                updateCharts();
            }
        }

        function updateDashboardStats() {
            document.getElementById('total-students').textContent = dataModels.students.length;
            document.getElementById('total-teachers').textContent = dataModels.teachers.length;
            document.getElementById('total-classes').textContent = dataModels.classes.length;
            
            // Calculate pending fees (simplified - in real app, calculate based on unpaid fees)
            const pendingFees = dataModels.fees.reduce((total, fee) => {
                return total + (fee.status === 'pending' ? parseFloat(fee.amount) : 0);
            }, 0);
            
            document.getElementById('pending-fees').textContent = pendingFees.toLocaleString();
            
            // Update recent activity
            updateRecentActivity();
        }

        function updateRecentActivity() {
            const tbody = document.getElementById('recent-activity');
            tbody.innerHTML = '';
            
            // Get recent fees and admissions (last 5)
            const recentFees = dataModels.fees.slice(-3).reverse();
            const recentAdmissions = dataModels.students.slice(-2).reverse();
            
            const activities = [];
            
            // Add fee activities
            recentFees.forEach(fee => {
                const student = dataModels.students.find(s => s.id === fee.studentId);
                if (student) {
                    activities.push({
                        date: fee.date,
                        activity: `Fee Collection - ${student.name}`,
                        amount: `₨ ${parseInt(fee.amount).toLocaleString()}`,
                        status: 'Completed'
                    });
                }
            });
            
            // Add admission activities
            recentAdmissions.forEach(student => {
                activities.push({
                    date: '2023-11-15', // This would be the admission date in a real app
                    activity: `New Admission - ${student.name}`,
                    amount: `₨ 8,500`,
                    status: 'Completed'
                });
            });
            
            // Sort by date (most recent first) and take top 4
            activities.sort((a, b) => new Date(b.date) - new Date(a.date));
            activities.slice(0, 4).forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(activity.date)}</td>
                    <td>${activity.activity}</td>
                    <td class="pkr-amount">${activity.amount}</td>
                    <td><span style="color: var(--accent-green);">${activity.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-PK', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            }) + ', ' + date.toLocaleTimeString('en-PK', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function populateClassDropdowns() {
            const classDropdowns = [
                'student-class',
                'assigned-class',
                'attendance-class',
                'filter-class'
            ];
            
            classDropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    // Clear existing options except the first one
                    while (dropdown.children.length > 1) {
                        dropdown.removeChild(dropdown.lastChild);
                    }
                    
                    // Add classes from data
                    dataModels.classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls.id;
                        option.textContent = cls.className;
                        dropdown.appendChild(option);
                    });
                }
            });
        }

        function populateStudentDropdowns() {
            const studentDropdowns = [
                'fee-student'
            ];
            
            studentDropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    // Clear existing options except the first one
                    while (dropdown.children.length > 1) {
                        dropdown.removeChild(dropdown.lastChild);
                    }
                    
                    // Add students from data
                    dataModels.students.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student.id;
                        option.textContent = `${student.name} (${getClassName(student.class)})`;
                        dropdown.appendChild(option);
                    });
                }
            });
        }

        function getClassName(classId) {
            const cls = dataModels.classes.find(c => c.id === classId);
            return cls ? cls.className : 'Unknown';
        }

        function getStudentName(studentId) {
            const student = dataModels.students.find(s => s.id === studentId);
            return student ? student.name : 'Unknown';
        }

        // Class Management
        function handleClassFormSubmit(e) {
            e.preventDefault();
            
            const className = document.getElementById('class-name').value.trim();
            
            if (className) {
                const newClass = {
                    id: generateId(),
                    className: className
                };
                
                dataModels.classes.push(newClass);
                saveData('classes');
                
                // Reset form
                e.target.reset();
                
                // Update UI
                populateClassDropdowns();
                renderClassesTable();
                updateDashboardStats();
                
                alert('Class added successfully!');
            }
        }

        function renderClassesTable() {
            const tbody = document.querySelector('#classes-table tbody');
            tbody.innerHTML = '';
            
            dataModels.classes.forEach(cls => {
                const studentCount = dataModels.students.filter(s => s.class === cls.id).length;
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${cls.id}</td>
                    <td>${cls.className}</td>
                    <td>${studentCount}</td>
                    <td class="action-buttons">
                        <button class="btn btn-small btn-outline edit-class" data-id="${cls.id}">Edit</button>
                        <button class="btn btn-small delete-class" data-id="${cls.id}" style="background-color: #ff4757;">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-class').forEach(btn => {
                btn.addEventListener('click', function() {
                    const classId = this.getAttribute('data-id');
                    editClass(classId);
                });
            });
            
            document.querySelectorAll('.delete-class').forEach(btn => {
                btn.addEventListener('click', function() {
                    const classId = this.getAttribute('data-id');
                    deleteClass(classId);
                });
            });
        }

        function editClass(classId) {
            const cls = dataModels.classes.find(c => c.id === classId);
            if (cls) {
                const newName = prompt('Enter new class name:', cls.className);
                if (newName && newName.trim()) {
                    cls.className = newName.trim();
                    saveData('classes');
                    renderClassesTable();
                    populateClassDropdowns();
                }
            }
        }

        function deleteClass(classId) {
            if (confirm('Are you sure you want to delete this class? This action cannot be undone.')) {
                // Check if class is being used by students or teachers
                const studentsUsingClass = dataModels.students.some(s => s.class === classId);
                const teachersUsingClass = dataModels.teachers.some(t => t.classAssigned === classId);
                
                if (studentsUsingClass || teachersUsingClass) {
                    alert('Cannot delete class. It is being used by students or teachers.');
                    return;
                }
                
                dataModels.classes = dataModels.classes.filter(c => c.id !== classId);
                saveData('classes');
                renderClassesTable();
                populateClassDropdowns();
            }
        }

        // Student Admissions
        function handleAdmissionFormSubmit(e) {
            e.preventDefault();
            
            const studentData = {
                id: generateId(),
                name: document.getElementById('student-name').value.trim(),
                fatherName: document.getElementById('father-name').value.trim(),
                dob: document.getElementById('dob').value,
                class: document.getElementById('student-class').value,
                contact: document.getElementById('contact').value.trim(),
                address: document.getElementById('address').value.trim(),
                emergencyContact: document.getElementById('emergency-contact').value.trim(),
                photoURL: document.getElementById('photo') ? document.getElementById('photo').value.trim() : null
            };
            
            // Validate required fields
            if (!studentData.name || !studentData.fatherName || !studentData.dob || 
                !studentData.class || !studentData.contact || !studentData.emergencyContact) {
                alert('Please fill in all required fields.');
                return;
            }
            
            dataModels.students.push(studentData);
            saveData('students');
            
            // Reset form
            e.target.reset();
            
            // Update UI
            renderStudentsTable();
            populateStudentDropdowns();
            updateDashboardStats();
            
            alert('Student added successfully!');
        }

        function renderStudentsTable() {
            const tbody = document.querySelector('#students-table tbody');
            tbody.innerHTML = '';
            
            dataModels.students.forEach(student => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.fatherName}</td>
                    <td>${getClassName(student.class)}</td>
                    <td>${student.contact}</td>
                    <td class="action-buttons">
                        <button class="btn btn-small btn-outline edit-student" data-id="${student.id}">Edit</button>
                        <button class="btn btn-small delete-student" data-id="${student.id}" style="background-color: #ff4757;">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-student').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = this.getAttribute('data-id');
                    editStudent(studentId);
                });
            });
            
            document.querySelectorAll('.delete-student').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = this.getAttribute('data-id');
                    deleteStudent(studentId);
                });
            });
        }

        function editStudent(studentId) {
            const student = dataModels.students.find(s => s.id === studentId);
            if (student) {
                // In a real app, you would show a form with pre-filled values
                // For simplicity, we'll use prompts
                const newName = prompt('Enter new student name:', student.name);
                if (newName && newName.trim()) {
                    student.name = newName.trim();
                    saveData('students');
                    renderStudentsTable();
                    populateStudentDropdowns();
                }
            }
        }

        function deleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
                dataModels.students = dataModels.students.filter(s => s.id !== studentId);
                saveData('students');
                renderStudentsTable();
                populateStudentDropdowns();
                updateDashboardStats();
            }
        }

        // Teacher Management
        function handleTeacherFormSubmit(e) {
            e.preventDefault();
            
            const teacherData = {
                id: generateId(),
                name: document.getElementById('teacher-name').value.trim(),
                subject: document.getElementById('subject').value.trim(),
                contact: document.getElementById('teacher-contact').value.trim(),
                classAssigned: document.getElementById('assigned-class').value
            };
            
            // Validate required fields
            if (!teacherData.name || !teacherData.subject || !teacherData.contact || !teacherData.classAssigned) {
                alert('Please fill in all required fields.');
                return;
            }
            
            dataModels.teachers.push(teacherData);
            saveData('teachers');
            
            // Reset form
            e.target.reset();
            
            // Update UI
            renderTeachersTable();
            updateDashboardStats();
            
            alert('Teacher added successfully!');
        }

        function renderTeachersTable() {
            const tbody = document.querySelector('#teachers-table tbody');
            tbody.innerHTML = '';
            
            dataModels.teachers.forEach(teacher => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${teacher.id}</td>
                    <td>${teacher.name}</td>
                    <td>${teacher.subject}</td>
                    <td>${teacher.contact}</td>
                    <td>${getClassName(teacher.classAssigned)}</td>
                    <td class="action-buttons">
                        <button class="btn btn-small btn-outline edit-teacher" data-id="${teacher.id}">Edit</button>
                        <button class="btn btn-small delete-teacher" data-id="${teacher.id}" style="background-color: #ff4757;">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-teacher').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teacherId = this.getAttribute('data-id');
                    editTeacher(teacherId);
                });
            });
            
            document.querySelectorAll('.delete-teacher').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teacherId = this.getAttribute('data-id');
                    deleteTeacher(teacherId);
                });
            });
        }

        function editTeacher(teacherId) {
            const teacher = dataModels.teachers.find(t => t.id === teacherId);
            if (teacher) {
                const newName = prompt('Enter new teacher name:', teacher.name);
                if (newName && newName.trim()) {
                    teacher.name = newName.trim();
                    saveData('teachers');
                    renderTeachersTable();
                }
            }
        }

        function deleteTeacher(teacherId) {
            if (confirm('Are you sure you want to delete this teacher? This action cannot be undone.')) {
                dataModels.teachers = dataModels.teachers.filter(t => t.id !== teacherId);
                saveData('teachers');
                renderTeachersTable();
                updateDashboardStats();
            }
        }

        // Attendance Management
        function loadAttendanceStudents() {
            const classId = document.getElementById('attendance-class').value;
            const date = document.getElementById('attendance-date').value;
            
            if (!classId || !date) {
                document.getElementById('attendance-table-container').classList.add('hidden');
                return;
            }
            
            const studentsInClass = dataModels.students.filter(s => s.class === classId);
            const tbody = document.querySelector('#attendance-table tbody');
            tbody.innerHTML = '';
            
            studentsInClass.forEach(student => {
                // Check if attendance already exists for this student on this date
                const existingAttendance = dataModels.attendance.find(a => 
                    a.studentId === student.id && a.date === date
                );
                
                const status = existingAttendance ? existingAttendance.status : 'present';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>
                        <div class="attendance-toggle">
                            <button class="toggle-btn ${status === 'present' ? 'active' : ''}" data-status="present">Present</button>
                            <button class="toggle-btn ${status === 'absent' ? 'active absent' : ''}" data-status="absent">Absent</button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners to toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const status = this.getAttribute('data-status');
                    
                    // Update active state
                    row.querySelectorAll('.toggle-btn').forEach(b => {
                        b.classList.remove('active', 'absent');
                    });
                    this.classList.add('active');
                    if (status === 'absent') {
                        this.classList.add('absent');
                    }
                });
            });
            
            document.getElementById('attendance-table-container').classList.remove('hidden');
        }

        function saveAttendance() {
            const classId = document.getElementById('attendance-class').value;
            const date = document.getElementById('attendance-date').value;
            
            if (!classId || !date) {
                alert('Please select both class and date.');
                return;
            }
            
            const studentsInClass = dataModels.students.filter(s => s.class === classId);
            const rows = document.querySelectorAll('#attendance-table tbody tr');
            
            // Remove existing attendance records for this class and date
            dataModels.attendance = dataModels.attendance.filter(a => 
                !(a.date === date && studentsInClass.some(s => s.id === a.studentId))
            );
            
            // Add new attendance records
            rows.forEach(row => {
                const studentId = row.cells[0].textContent;
                const status = row.querySelector('.toggle-btn.active').getAttribute('data-status');
                
                dataModels.attendance.push({
                    id: generateId(),
                    studentId: studentId,
                    class: classId,
                    date: date,
                    status: status
                });
            });
            
            saveData('attendance');
            alert('Attendance saved successfully!');
        }

        // Fees Management
        function handleFeeFormSubmit(e) {
            e.preventDefault();
            
            const feeData = {
                id: generateId(),
                studentId: document.getElementById('fee-student').value,
                month: document.getElementById('fee-month').value,
                amount: document.getElementById('fee-amount').value,
                date: new Date().toISOString().split('T')[0],
                status: 'paid'
            };
            
            // Validate required fields
            if (!feeData.studentId || !feeData.month || !feeData.amount) {
                alert('Please fill in all required fields.');
                return;
            }
            
            dataModels.fees.push(feeData);
            saveData('fees');
            
            // Reset form
            e.target.reset();
            
            // Update UI
            renderFeesTable();
            updateDashboardStats();
            
            alert('Fee collected successfully!');
        }

        function renderFeesTable() {
            const tbody = document.querySelector('#fees-table tbody');
            tbody.innerHTML = '';
            
            const classFilter = document.getElementById('filter-class').value;
            const monthFilter = document.getElementById('filter-month').value;
            
            let filteredFees = dataModels.fees;
            
            if (classFilter) {
                // Get students in the filtered class
                const studentIdsInClass = dataModels.students
                    .filter(s => s.class === classFilter)
                    .map(s => s.id);
                
                filteredFees = filteredFees.filter(fee => 
                    studentIdsInClass.includes(fee.studentId)
                );
            }
            
            if (monthFilter) {
                filteredFees = filteredFees.filter(fee => fee.month === monthFilter);
            }
            
            filteredFees.forEach(fee => {
                const student = dataModels.students.find(s => s.id === fee.studentId);
                
                if (student) {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${fee.id}</td>
                        <td>${student.name}</td>
                        <td>${getClassName(student.class)}</td>
                        <td>${fee.month}</td>
                        <td class="pkr-amount">₨ ${parseInt(fee.amount).toLocaleString()}</td>
                        <td>${fee.date}</td>
                        <td><span class="status-badge ${fee.status === 'paid' ? 'status-paid' : 'status-pending'}">${fee.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-small btn-outline" onclick="generateReceiptForFee('${fee.id}')">Receipt</button>
                            <button class="btn btn-small delete-fee" data-id="${fee.id}" style="background-color: #ff4757;">Delete</button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                }
            });
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-fee').forEach(btn => {
                btn.addEventListener('click', function() {
                    const feeId = this.getAttribute('data-id');
                    deleteFee(feeId);
                });
            });
        }

        function deleteFee(feeId) {
            if (confirm('Are you sure you want to delete this fee record? This action cannot be undone.')) {
                dataModels.fees = dataModels.fees.filter(f => f.id !== feeId);
                saveData('fees');
                renderFeesTable();
                updateDashboardStats();
            }
        }

        function generateReceipt() {
            alert('Receipt generation would be implemented here. In a real app, this would generate a PDF.');
        }

        function generateReceiptForFee(feeId) {
            const fee = dataModels.fees.find(f => f.id === feeId);
            if (fee) {
                const student = dataModels.students.find(s => s.id === fee.studentId);
                alert(`Receipt for ${student.name} - Amount: ₨ ${fee.amount} for ${fee.month}`);
            }
        }

        function exportFeesToCSV() {
            // Simple CSV export implementation
            let csvContent = "ID,Student Name,Class,Month,Amount,Date,Status\n";
            
            dataModels.fees.forEach(fee => {
                const student = dataModels.students.find(s => s.id === fee.studentId);
                if (student) {
                    csvContent += `${fee.id},${student.name},${getClassName(student.class)},${fee.month},${fee.amount},${fee.date},${fee.status}\n`;
                }
            });
            
            // Create and download the file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'fees_data.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Reports and Charts
        function initializeCharts() {
            // Attendance chart
            const attendanceCtx = document.getElementById('attendance-chart').getContext('2d');
            attendanceChart = new Chart(attendanceCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Present',
                        data: [],
                        backgroundColor: '#00D26A'
                    }, {
                        label: 'Absent',
                        data: [],
                        backgroundColor: '#FF4757'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Fees chart
            const feesCtx = document.getElementById('fees-chart').getContext('2d');
            feesChart = new Chart(feesCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Fees Collected (PKR)',
                        data: [],
                        borderColor: '#00BFFF',
                        backgroundColor: 'rgba(0, 191, 255, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            updateCharts();
        }

        function updateCharts() {
            // Update attendance chart
            const classLabels = dataModels.classes.map(c => c.className);
            const presentData = [];
            const absentData = [];
            
            // For simplicity, we'll use the latest attendance data for each class
            dataModels.classes.forEach(cls => {
                const classStudents = dataModels.students.filter(s => s.class === cls.id);
                const classAttendance = dataModels.attendance.filter(a => a.class === cls.id);
                
                // Get the latest date
                const latestDate = classAttendance.length > 0 ? 
                    Math.max(...classAttendance.map(a => new Date(a.date).getTime())) : null;
                
                if (latestDate) {
                    const latestAttendance = classAttendance.filter(a => 
                        new Date(a.date).getTime() === latestDate
                    );
                    
                    const presentCount = latestAttendance.filter(a => a.status === 'present').length;
                    const absentCount = latestAttendance.filter(a => a.status === 'absent').length;
                    
                    presentData.push(presentCount);
                    absentData.push(absentCount);
                } else {
                    presentData.push(0);
                    absentData.push(0);
                }
            });
            
            attendanceChart.data.labels = classLabels;
            attendanceChart.data.datasets[0].data = presentData;
            attendanceChart.data.datasets[1].data = absentData;
            attendanceChart.update();
            
            // Update fees chart
            const months = [...new Set(dataModels.fees.map(f => f.month))].sort();
            const feesData = months.map(month => {
                return dataModels.fees
                    .filter(f => f.month === month)
                    .reduce((sum, fee) => sum + parseFloat(fee.amount), 0);
            });
            
            feesChart.data.labels = months;
            feesChart.data.datasets[0].data = feesData;
            feesChart.update();
        }

        // Data Export
        function exportData() {
            const exportType = document.getElementById('export-type').value;
            const exportFormat = document.getElementById('export-format').value;
            
            let dataToExport;
            let fileName;
            
            switch(exportType) {
                case 'students':
                    dataToExport = dataModels.students;
                    fileName = 'students';
                    break;
                case 'teachers':
                    dataToExport = dataModels.teachers;
                    fileName = 'teachers';
                    break;
                case 'attendance':
                    dataToExport = dataModels.attendance;
                    fileName = 'attendance';
                    break;
                case 'fees':
                    dataToExport = dataModels.fees;
                    fileName = 'fees';
                    break;
                default:
                    dataToExport = [];
                    fileName = 'data';
            }
            
            if (exportFormat === 'json') {
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${fileName}.json`;
                a.click();
                URL.revokeObjectURL(url);
            } else if (exportFormat === 'csv') {
                // Simple CSV conversion
                if (dataToExport.length === 0) {
                    alert('No data to export.');
                    return;
                }
                
                const headers = Object.keys(dataToExport[0]);
                let csvContent = headers.join(',') + '\n';
                
                dataToExport.forEach(item => {
                    const row = headers.map(header => {
                        let value = item[header];
                        // Handle values that might contain commas
                        if (typeof value === 'string' && value.includes(',')) {
                            value = `"${value}"`;
                        }
                        return value;
                    }).join(',');
                    csvContent += row + '\n';
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${fileName}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        // Settings
        function setTheme(theme) {
            if (theme === 'light') {
                document.documentElement.style.setProperty('--bg-primary', '#FFFFFF');
                document.documentElement.style.setProperty('--bg-secondary', '#F5F5F5');
                document.documentElement.style.setProperty('--text-primary', '#333333');
                document.documentElement.style.setProperty('--text-secondary', '#666666');
            } else {
                document.documentElement.style.setProperty('--bg-primary', '#121212');
                document.documentElement.style.setProperty('--bg-secondary', '#1E1E1E');
                document.documentElement.style.setProperty('--text-primary', '#FFFFFF');
                document.documentElement.style.setProperty('--text-secondary', '#B0B0B0');
            }
        }

        function backupData() {
            const allData = {};
            for (const key in dataModels) {
                allData[key] = dataModels[key];
            }
            
            const dataStr = JSON.stringify(allData, null, 2);
            document.getElementById('data-modal-title').textContent = 'Backup Data';
            document.getElementById('data-content').value = dataStr;
            document.getElementById('data-modal').classList.add('active');
        }

        function restoreData() {
            document.getElementById('data-modal-title').textContent = 'Restore Data';
            document.getElementById('data-content').value = '';
            document.getElementById('data-modal').classList.add('active');
            
            // Store the action to perform after data is entered
            window.pendingAction = 'restore';
        }

        function copyDataToClipboard() {
            const textarea = document.getElementById('data-content');
            textarea.select();
            document.execCommand('copy');
            alert('Data copied to clipboard!');
        }

        function confirmClearData() {
            document.getElementById('confirmation-message').textContent = 
                'Are you sure you want to clear all data? This action cannot be undone.';
            document.getElementById('confirmation-modal').classList.add('active');
            
            // Store the action to perform if confirmed
            window.pendingAction = 'clear';
        }

        function executeConfirmedAction() {
            if (window.pendingAction === 'clear') {
                // Clear all data
                for (const key in dataModels) {
                    dataModels[key] = [];
                    saveData(key);
                }
                
                // Update UI
                updateDashboardStats();
                populateClassDropdowns();
                populateStudentDropdowns();
                renderClassesTable();
                renderStudentsTable();
                renderTeachersTable();
                renderFeesTable();
                updateCharts();
                
                alert('All data has been cleared.');
            } else if (window.pendingAction === 'restore') {
                // Restore data from textarea
                try {
                    const restoredData = JSON.parse(document.getElementById('data-content').value);
                    
                    for (const key in restoredData) {
                        if (dataModels.hasOwnProperty(key)) {
                            dataModels[key] = restoredData[key];
                            saveData(key);
                        }
                    }
                    
                    // Update UI
                    updateDashboardStats();
                    populateClassDropdowns();
                    populateStudentDropdowns();
                    renderClassesTable();
                    renderStudentsTable();
                    renderTeachersTable();
                    renderFeesTable();
                    updateCharts();
                    
                    alert('Data restored successfully!');
                } catch (e) {
                    alert('Invalid data format. Please check your backup data.');
                }
            }
            
            closeModals();
        }

        function closeModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
            
            window.pendingAction = null;
        }

        // Utility Functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Make some functions available globally for onclick handlers
        window.generateReceiptForFee = generateReceiptForFee;
    </script>
</body>
</html>
